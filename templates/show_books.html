<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="/static/main.css">
        <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
        <title>Bücher anzeigen</title>
    </head>
    <body>
        <h1 class="bookoverview">Buchübersicht</h1>

        <a href="/" class="back">Zurück zur Startseite</a>
        <!-- If not all books of the database are displayed show a button to display all books -->
        {% if not all_books %}
        <a href="/show_books" class="back">Alle Bücher anzeigen</a>
        {% endif %}
        
        <form action="/show_books" method="get" class="dropdown">

            <!-- Keep search parameters in hidden fields so they persist after sorting -->
            <input type="hidden" name="title" value="{{ request.args.get('title', '') }}">
            <input type="hidden" name="author" value="{{ request.args.get('author', '') }}">
            <input type="hidden" name="genre" value="{{ request.args.get('genre', '') }}">
            <input type="hidden" name="isbn" value="{{ request.args.get('isbn', '') }}">

            <label for="sorting">Sortierung: </label> <br>
            <!-- Dropdown menu with sorting options -->
            <select name="sorting" id="sorting" onchange="this.form.submit()">
                <!-- Jinja conditional: check the current sorting parameter -->
                <option value="title" {% if request.args.get('sorting', 'title') == 'title' %}selected{% endif %}>Titel</option>
                <option value="author" {% if request.args.get('sorting', 'title') == 'author' %}selected{% endif %}>Autor</option>
                <option value="position" {% if request.args.get('sorting', 'title') == 'position' %}selected{% endif %}>Position</option>
                <option value="yearNew" {% if request.args.get('sorting', 'title') == 'yearNew' %}selected{% endif %}>Erscheinungsjahr: Neuste zuerst</option>
                <option value="yearOld" {% if request.args.get('sorting', 'title') == 'yearOld' %}selected{% endif %}>Erscheinungsjahr: Älteste zuerst</option>
            </select>
        </form>

        <!-- Table to display the books -->
        <table>
            <thead>
                <tr>
                    <th>Titel</th>
                    <th>Autor</th>
                    <th>Erscheinungsjahr</th>
                    <th>Genre</th>
                    <th>ISBN</th>
                    <th>Reihe</th>
                    <th>Position</th>
                    <th>Breite</th>
                </tr>
            </thead>
            <tbody>
                <!-- Jinja for loop: iterate through the list 'books' -->
                {% for book in books %}
                <tr>
                    <td>{{ book[0] }}</td>
                    <td>{{ book[1] }}</td>
                    <td>{{ book[2] }}</td>
                    <td>{{ book[3] }}</td>
                    <td>{{ book[4] }}</td>
                    <td>{{ book[5] }}</td>
                    <td>{{ book[6] }}</td>
                    <td>{{ book[7] }}</td>
                    <td>
                        <!-- Button to edit a book, based on its ISBN -->
                        <form action="/edit_book/{{ book[4] }}" method="get">
                            <input type="submit" value="Bearbeiten" class="submit">
                            <input type="hidden" name="isbn" value="{{ book[4] }}">
                        </form>
                    <td>
                        <!-- Button to delete a book, based on its ISBN -->
                        <form action="/delete_book" method="post">
                            <input type="submit" value="Löschen" class="submit">
                            <input type="hidden" name="isbn" value="{{ book[4] }}">
                        </form>
                    </td>    
                    </td>
                </tr>
                {% endfor %}

                <!--Jinja conditional: Display a message if no books are found-->
                {% if not books %}
                <tr>
                    <td colspan="9" class="note">Bisher stehen noch keine Bücher in Deinem Regal</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </body>
</html>